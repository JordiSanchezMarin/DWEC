<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>La volta</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-57-precomposed.png">
    <link rel="shortcut icon" href="img/favicon.png">
  
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/scripts.js"></script>
    <script type="text/javascript" src="jquery-1.3.2.js">
        
    </script>
    <style type="text/css">
        .c
        {
            border:2px solid black;
            margin:3px;
        }
        .lblestadoperdedor {
	        background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #f05348), color-stop(1, #e6594c) );
	        background:-moz-linear-gradient( center top, #f05348 5%, #e6594c 100% );
	        filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#f05348', endColorstr='#e6594c');
	        background-color:#f05348;
	        -webkit-border-top-left-radius:0px;
	        -moz-border-radius-topleft:0px;
	        border-top-left-radius:0px;
	        -webkit-border-top-right-radius:0px;
	        -moz-border-radius-topright:0px;
	        border-top-right-radius:0px;
	        -webkit-border-bottom-right-radius:0px;
	        -moz-border-radius-bottomright:0px;
	        border-bottom-right-radius:0px;
	        -webkit-border-bottom-left-radius:0px;
	        -moz-border-radius-bottomleft:0px;
	        border-bottom-left-radius:0px;
	        text-indent:0;
	        border:1px solid #d02718;
	        display:inline-block;
	        color:#362e36;
	        font-family:Verdana;
	        font-size:15px;
	        font-weight:bold;
	        font-style:normal;
	        height:50px;
	        line-height:50px;
	        width:100px;
	        text-decoration:none;
	        text-align:center;
	        text-shadow:1px 0px 50px #810e05;
        }
        .lblestadoganador {
	        -moz-box-shadow:inset 0px 1px 0px 0px #caefab;
	        -webkit-box-shadow:inset 0px 1px 0px 0px #caefab;
	        box-shadow:inset 0px 1px 0px 0px #caefab;
	        background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #77d42a), color-stop(1, #5cb811) );
	        background:-moz-linear-gradient( center top, #77d42a 5%, #5cb811 100% );
	        filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#77d42a', endColorstr='#5cb811');
	        background-color:#77d42a;
	        -webkit-border-top-left-radius:0px;
	        -moz-border-radius-topleft:0px;
	        border-top-left-radius:0px;
	        -webkit-border-top-right-radius:0px;
	        -moz-border-radius-topright:0px;
	        border-top-right-radius:0px;
	        -webkit-border-bottom-right-radius:0px;
	        -moz-border-radius-bottomright:0px;
	        border-bottom-right-radius:0px;
	        -webkit-border-bottom-left-radius:0px;
	        -moz-border-radius-bottomleft:0px;
	        border-bottom-left-radius:0px;
	        text-indent:0;
	        border:1px solid #268a16;
	        display:inline-block;
	        color:#306108;
	        font-family:Verdana;
	        font-size:15px;
	        font-weight:bold;
	        font-style:normal;
	        height:50px;
	        line-height:50px;
	        width:100px;
	        text-decoration:none;
	        text-align:center;
	        text-shadow:1px 1px 0px #aade7c;
        }
        label
        {
            -moz-box-shadow:inset 0px 1px 0px 0px #ffffff;
	        -webkit-box-shadow:inset 0px 1px 0px 0px #ffffff;
	        box-shadow:inset 0px 1px 0px 0px #ffffff;
	        background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #ffffff), color-stop(1, #a89ea8) );
	        background:-moz-linear-gradient( center top, #ffffff 5%, #a89ea8 100% );
	        filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#a89ea8');
	        background-color:#ffffff;
	        -webkit-border-top-left-radius:0px;
	        -moz-border-radius-topleft:0px;
	        border-top-left-radius:0px;
	        -webkit-border-top-right-radius:0px;
	        -moz-border-radius-topright:0px;
	        border-top-right-radius:0px;
	        -webkit-border-bottom-right-radius:0px;
	        -moz-border-radius-bottomright:0px;
	        border-bottom-right-radius:0px;
	        -webkit-border-bottom-left-radius:0px;
	        -moz-border-radius-bottomleft:0px;
	        border-bottom-left-radius:0px;
	        text-indent:0;
	        border:1px solid #0f0e0f;
	        display:inline-block;
	        color:#0d0d0d;
	        font-family:Verdana;
	        font-weight:bold;
	        font-style:normal;
	        text-decoration:none;
	        text-align:center;
        }
        .classname {
	    -moz-box-shadow:inset 0px 1px 0px 0px #ffffff;
	    -webkit-box-shadow:inset 0px 1px 0px 0px #ffffff;
	    box-shadow:inset 0px 1px 0px 0px #ffffff;
	    background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #ffffff), color-stop(1, #a89ea8) );
	    background:-moz-linear-gradient( center top, #ffffff 5%, #a89ea8 100% );
	    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#a89ea8');
	    background-color:#ffffff;
	    -webkit-border-top-left-radius:0px;
	    -moz-border-radius-topleft:0px;
	    border-top-left-radius:0px;
	    -webkit-border-top-right-radius:0px;
	    -moz-border-radius-topright:0px;
	    border-top-right-radius:0px;
	    -webkit-border-bottom-right-radius:0px;
	    -moz-border-radius-bottomright:0px;
	    border-bottom-right-radius:0px;
	    -webkit-border-bottom-left-radius:0px;
	    -moz-border-radius-bottomleft:0px;
	    border-bottom-left-radius:0px;
	    text-indent:0;
	    border:1px solid #0f0e0f;
	    display:inline-block;
	    color:#0d0d0d;
	    font-family:Verdana;
	    font-size:16px;
	    font-weight:bold;
	    font-style:normal;
	    height:40px;
	    line-height:40px;
	    width:100px;
	    text-decoration:none;
	    text-align:center;
	    margin-bottom:10px;
    }
    .classname:hover {
	    background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #a89ea8), color-stop(1, #ffffff) );
	    background:-moz-linear-gradient( center top, #a89ea8 5%, #ffffff 100% );
	    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#a89ea8', endColorstr='#ffffff');
	    background-color:#a89ea8;
    }.classname:active {
	    position:relative;
	    top:1px;
    }
</style>
    <script type="text/javascript">

        // Variables Globales ---------------------------------------------------------------------------------------------------------------------------------------------------------
        var cont11 = Math.round(Math.random() * 0);
        var cont12 = Math.round(Math.random() * 0);
        var cont13 = Math.round(Math.random() * 0);

        var cont21 = Math.round(Math.random() * 0);
        var cont22 = Math.round(Math.random() * 0);
        var cont23 = Math.round(Math.random() * 0);

        var bool11 = false;
        var bool12 = false;
        var bool13 = false;

        var bool21 = false;
        var bool22 = false;
        var bool23 = false;

        var puntos11;
        var puntos12;
        var puntos13;

        var puntos21;
        var puntos22;
        var puntos23;

        var timer;

        var db;

        // Funcion que detecta si el navegador soporta IndexedDB-----------------------------------------------------------------------------------------------------------------------
        function indexedDBOk() {
            return "indexedDB" in window;
        }
        // Preparacion de la base de datos---------------------------------------------------------------------------------------------------------------------------------------------
        document.addEventListener("DOMContentLoaded", function () {
            if (!indexedDBOk) return;
            //crea la base de datos llamada "laVolta"
            var openRequest = indexedDB.open("laVolta", 1);
            openRequest.onupgradeneeded = function (e) {
                var thisDB = e.target.result;
                //si la tabla "partidas" no esta creada en la base de datos, la crea
                if (!thisDB.objectStoreNames.contains("partidas")) {
                    //autoIncrement --> base de datos la cual sus keys se van incrementando cada vez que añades un registro
                    thisDB.createObjectStore("partidas", { autoIncrement: true });
                }
            }
            openRequest.onsuccess = function (e) {
                console.log("running onsuccess");
                db = e.target.result;
                //añade 2 eventos a dos botones html: onClick(guardarPartida) onClick(cargarPartida)
                document.querySelector("#btnSave").addEventListener("click", guardarPartida, false);
                document.querySelector("#btnLoad").addEventListener("click", cargarPartida, false);
            }
            openRequest.onerror = function (e) {
            }
        }, false);
        //Esta funcion se utiliza para guardar los datos en la base de datos ------------------------------------------------------------------------------------------------------
        function guardarPartida(e) {
            //crea una transaccion de lectura y escritura en la tabla partidas
            var transaction = db.transaction(["partidas"], "readwrite");
            //a traves de la transaccion se recoge la tabla y se guarda en store
            var store = transaction.objectStore("partidas");
            //se crea un objeto con todos los datos que queremos almacenar
            var partida = {
                x11: cont11,
                p11: puntos11,
                x12: cont12,
                p12: puntos12,
                x13: cont13,
                p13: puntos13,
                x21: cont21,
                p21: puntos21,
                x22: cont22,
                p22: puntos22,
                x23: cont23,
                p23: puntos23,
                created: new Date()
            }
            //se añade a la tabla "partidas" el objeto creado
            var request = store.add(partida);
            request.onerror = function (e) {
                console.log("Error", e.target.error.name);
            }
            request.onsuccess = function (e) {
                console.log("Woot! Did it");
            }
        }
//Esta funcion se utiliza para cargar los datos de una base de datos a traves de una key --------------------------------------------------------------------------------------------
        function cargarPartida(e) {
            //recoge la key
            var key = document.querySelector("#key").value;
            if (key === "" || isNaN(key)) return;
            //crea una transaccion de solo lectura en la tabla partidas
            var transaction = db.transaction(["partidas"], "readonly");
            //utiliza la transaccion para obtener la tabla 
            var store = transaction.objectStore("partidas");
            //utiliza la tabla para recoger un registro a partir de la key indicada anteriormente
            var request = store.get(Number(key));
            request.onsuccess = function (e) {
                var result = e.target.result;
                console.dir(result);
                //si encuentra un resultado...
                if (result) {
                    var pa = new Array();
                    var i = 0;
                    //por cada campo que haya en el tabla se añade en la array
                    for (var field in result) {
                        pa[i] = result[field];
                        i++;
                    }
                    for (i = 0; i <= 5; i++) {
                        $("#lbl" + i).attr("style", "position:relative");
                    }
                    //se recogen los metros recorridos y los metros maximos por turno de cada jugador, ademas se coloca a cada uno en su posicion(metros recorridos)
                    cont11 = pa[0];
                    puntos11 = pa[1];
                    $("#eq0co0").css({ left: cont11 });
                    $("#lbl0").css({ left: cont11 });
                    $("#lbl0").html(calcularProcentaje(cont11));

                    cont12 = pa[2];
                    puntos12 = pa[3];
                    $("#eq0co1").css({ left: cont12 });
                    $("#lbl1").css({ left: cont12 });
                    $("#lbl1").html(calcularProcentaje(cont12));

                    cont13 = pa[4];
                    puntos13 = pa[5];
                    $("#eq0co2").css({ left: cont13 });
                    $("#lbl2").css({ left: cont13 });
                    $("#lbl2").html(calcularProcentaje(cont13));

                    cont21 = pa[6];
                    puntos21 = pa[7];
                    $("#eq1co0").css({ left: cont21 });
                    $("#lbl3").css({ left: cont21 });
                    $("#lbl3").html(calcularProcentaje(cont21));

                    cont22 = pa[8];
                    puntos22 = pa[9];
                    $("#eq1co1").css({ left: cont22 });
                    $("#lbl4").css({ left: cont22 });
                    $("#lbl4").html(calcularProcentaje(cont22));

                    cont23 = pa[10];
                    puntos23 = pa[11];
                    $("#eq1co2").css({ left: cont23 });
                    $("#lbl5").css({ left: cont23 });
                    $("#lbl5").html(calcularProcentaje(cont23));

                    //Se deshabilitan/habilitan los botones necesarios
                    document.getElementById("butonAgregar").disabled = true;
                    document.getElementById("buton").disabled = false;
                    document.getElementById("btnPass").disabled = false;
                } else {
                    console.log("No match");
                }
                //añade las imagenes a la tabla
                insertarBicis(1);
                $("#estado1").attr("style", "visibility:hidden");
                $("#estado2").attr("style", "visibility:hidden");
            }
        }

//Esta funcion se dedica a insertar las imagenes de las bicis, además de ponerlas en la posicion inicial en caso de que se empiece partida----------------------------------------------------
        function insertarBicis(num) {
            if (num == 0) {
                document.getElementById("eq0co0").setAttribute("src", "black_bike.png");
                document.getElementById("eq0co1").setAttribute("src", "black_bike.png");
                document.getElementById("eq0co2").setAttribute("src", "black_bike.png");
                document.getElementById("eq1co0").setAttribute("src", "brown_bike.png");
                document.getElementById("eq1co1").setAttribute("src", "brown_bike.png");
                document.getElementById("eq1co2").setAttribute("src", "brown_bike.png");
                $("#eq0co0").css({ left: 0 });
                $("#eq0co1").css({ left: 0 });
                $("#eq0co2").css({ left: 0 });
                $("#eq1co0").css({ left: 0 });
                $("#eq1co1").css({ left: 0 });
                $("#eq1co2").css({ left: 0 });
            }
            else if (num == 1) {
                document.getElementById("eq0co0").setAttribute("src", "black_bike.png");
                document.getElementById("eq0co1").setAttribute("src", "black_bike.png");
                document.getElementById("eq0co2").setAttribute("src", "black_bike.png");
                document.getElementById("eq1co0").setAttribute("src", "brown_bike.png");
                document.getElementById("eq1co1").setAttribute("src", "brown_bike.png");
                document.getElementById("eq1co2").setAttribute("src", "brown_bike.png");
            }
                
        }
        //Esta funcion se ejecuta cuando se carga el body, se encarga de crear la tabla ademas de insertar las imaganes ---------------------------------------------------------------------------
        function prepararMapa() {
            document.getElementById("btnPass").disabled = true;
            document.getElementById("buton").disabled = true;
            divgeneral = document.getElementById("divgeneral");
            divequipo1 = document.getElementById("divequipo1");

            for (i = 0; i <= 1; i++) {
                for (j = 0; j <= 2; j++) {
                    if (i == 0) {
                        c = document.getElementById("c" + j);
                    }
                    else {
                        c = document.getElementById("c2" + j);
                    }
                    c.setAttribute("style", "background-image:url('background1.jpg')");
                    imagen = document.createElement("img");
                    imagen.setAttribute("width", "68px");
                    imagen.setAttribute("height", "68px");
                    imagen.setAttribute("style", "position:relative");
                    imagen.setAttribute("id", "eq" + i + "co" + j);
                    c.appendChild(imagen);
                }
                
            }
            insertarBicis(0);
        }
        //Esta funcion se dedica a comprobar que se han introducido correctamente los metros por turno de cada corredor, ademas de recogerlos para poderlos utilizar en la carrera------------------------------
        function agregarPuntos() {
            cont11 = Math.round(Math.random() * 0);
            cont12 = Math.round(Math.random() * 0);
            cont13 = Math.round(Math.random() * 0);

            cont21 = Math.round(Math.random() * 0);
            cont22 = Math.round(Math.random() * 0);
            cont23 = Math.round(Math.random() * 0);

            insertarBicis(0);
            $("#estado1").attr("style", "visibility:hidden");
            $("#estado2").attr("style", "visibility:hidden");
            for (i = 0 , j = 0; i <= 5; i++,j++) {
                $("#lbl" + i).html("000%");
                $("#lbl" + i).attr("style", "position:relative;font-size:15px");
             
            }
            puntos11 = parseInt(document.getElementById("txt11").value);
            puntos12 = parseInt(document.getElementById("txt12").value);
            puntos13 = parseInt(document.getElementById("txt13").value);

            puntos21 = parseInt(document.getElementById("txt21").value);
            puntos22 = parseInt(document.getElementById("txt22").value);
            puntos23 = parseInt(document.getElementById("txt23").value);
            if ((puntos11 + puntos12 + puntos13) > 150 || (puntos21 + puntos22 + puntos23) > 150) {
                alert("Los puntos de un equipo no pueden ser superior a 150");
            }
            else if (puntos11 < 20 || puntos12 < 20 || puntos13 < 20 || puntos21 < 20 || puntos22 < 20 || puntos23 < 20) {
                alert("Los puntos de cada corredor no pueden ser inferior a 20");
            }
            else if (isNaN(puntos11) == true || isNaN(puntos12) == true || isNaN(puntos13) == true || isNaN(puntos21) == true || isNaN(puntos22) == true || isNaN(puntos23) == true) {
                alert("Solo puede introducir numeros");
            }
            else {
                document.getElementById("buton").disabled = false;
                document.getElementById("butonAgregar").disabled = true;
                document.getElementById("btnPass").disabled = false;
                document.getElementById("btnLoad").disabled = false;
                document.getElementById("btnSave").disabled = false;
            }
        }
        //Esta funcion devuelve un random, se utiliza en los metros recorridos por turno------------------------------------------------------------------------------------------------------------------------
        function random(r) {
            var rand = Math.round(Math.random() * r);
            return rand;
        }

        //Esta funcion se dedica a pasar la carrera hasta el final, he utlizado un setInterval, que se limpia cuando llegan al final ---------------------------------------------------------------------------
        function pasarCarrera() {
            document.getElementById("buton").disabled = true;
            document.getElementById("btnPass").disabled = true;
            document.getElementById("btnLoad").disabled = true;
            document.getElementById("btnSave").disabled = true;
            timer = setInterval(pasarTurno, 500);
        }
        //Esta funcion realiza la animacion de tirar para alante un corredor -----------------------------------------------------------------------------------------------------------------------------------
        function animar(id, random) {
            $("#" + id).animate({ "left": "+=" + random + "px" }, "slow");
        }
        //Esta funcion se ejecuta al final de la carrera, sirve para los corredores que hayan levantado rueda, vuelvan a su angulo inicial (0) ----------------------------------------------------------------
        function initRotate(id) {
                var css = '-webkit-transform: rotate(' + 1500 + Math.round(Math.random() * 1500) + 'deg);';
                $("#" + id).css("transform", "rotate(" + 0 + "deg)");
                $("#" + id).css("-moz-transform", "rotate(" + 0 + "deg)");
                $("#" + id).css("-webkit-transform", "rotate(" + 0 + "deg)");
                $("#" + id).css("-o-transform", "rotate(" + 0 + "deg)");
        }
        //Esta funcion sirve para calcular el porcentaje de carrera de un corredor
        function calcularProcentaje(cn) {
            por = Math.round((cn * 100) / 640);
            if(por < 10)
                return "00" + por + "%";
            if(por < 100)
                return "0" + por + "%";
            else
                return por + "%";
        }
        //Esta es la funcion mas importante, ya que contiene toda la logica del juego -------------------------------------------------------------------------------------------------------------------------
        function pasarTurno() {
            //recogemos los randoms de cada corredor
            rand11 = random(puntos11);
            rand12 = random(puntos12);
            rand13 = random(puntos13);

            rand21 = random(puntos21);
            rand22 = random(puntos22);
            rand23 = random(puntos23);

            var deg = 1500 + Math.round(Math.random() * 1500);
            var r = 0;
            //si la pagina esta cargada ...
            $(document).ready(function () {
                // EQUIPO 1 ---------------------------
                //si el corredor no ha llegado al final avanza "x" pixeles y los acumula en un contador
                if ((cont11 + rand11) < 645) {
                    animar("eq0co0", rand11);
                    cont11 = cont11 + rand11;
                    setTimeout(animar("lbl0", rand11), 700);
                    $("#lbl0").html(calcularProcentaje(cont11));

                }
                //en caso contrario ( el corredor a llegado al final) ...
                else {
                    if (bool11 == false) {
                        //cada 70 milisegundo el angulo de la imagen disminuye en 1
                        interval1 = setInterval(function () {
                            var css = '-webkit-transform: rotate(' + deg + 'deg);';
                            $("#eq0co0").css("transform", "rotate(" + r + "deg)");
                            $("#eq0co0").css("-moz-transform", "rotate(" + r + "deg)");
                            $("#eq0co0").css("-webkit-transform", "rotate(" + r + "deg)");
                            $("#eq0co0").css("-o-transform", "rotate(" + r + "deg)");
                            r--;
                            if (r <= -35)
                            //cuando el angulo de la imagen llega a -35 se limpia el interval
                                clearInterval(interval1);
                        }, 70);
                        //indica que el corredor en cuestion ha llegado al final
                        bool11 = true;
                    }
                }

                if ((cont12 + rand12) < 645) {
                    animar("eq0co1", rand12);
                    cont12 = cont12 + rand12;
                    setTimeout(animar("lbl1", rand12), 700);
                    $("#lbl1").html(calcularProcentaje(cont12));
                }
                else {
                    if (bool12 == false) {
                        interval2 = setInterval(function () {
                            var css = '-webkit-transform: rotate(' + deg + 'deg);';
                            $("#eq0co1").css("transform", "rotate(" + r + "deg)");
                            $("#eq0co1").css("-moz-transform", "rotate(" + r + "deg)");
                            $("#eq0co1").css("-webkit-transform", "rotate(" + r + "deg)");
                            $("#eq0co1").css("-o-transform", "rotate(" + r + "deg)");
                            r--;
                            if (r <= -35)
                                clearInterval(interval2);
                        }, 70);
                        bool12 = true;
                    }
                }
                if ((cont13 + rand13) < 645) {
                    animar("eq0co2", rand13);
                    cont13 = cont13 + rand13;
                    setTimeout(animar("lbl2", rand13), 700);
                    $("#lbl2").html(calcularProcentaje(cont13));
                }
                else {
                    if (bool13 == false) {
                        interval3 = setInterval(function () {
                            var css = '-webkit-transform: rotate(' + deg + 'deg);';
                            $("#eq0co2").css("transform", "rotate(" + r + "deg)");
                            $("#eq0co2").css("-moz-transform", "rotate(" + r + "deg)");
                            $("#eq0co2").css("-webkit-transform", "rotate(" + r + "deg)");
                            $("#eq0co2").css("-o-transform", "rotate(" + r + "deg)");
                            r--;
                            if (r <= -35)
                                clearInterval(interval3);
                        }, 70);
                        bool13 = true;
                    }
                }
                // EQUIPO 2 ---------------------------
                if ((cont21 + rand21) < 645) {
                    animar("eq1co0", rand21);
                    cont21 = cont21 + rand21;
                    setTimeout(animar("lbl3", rand21), 700);
                    $("#lbl3").html(calcularProcentaje(cont21));
                }
                else {
                    if (bool21 == false) {
                        interval4 = setInterval(function () {
                            var css = '-webkit-transform: rotate(' + deg + 'deg);';
                            $("#eq1co0").css("transform", "rotate(" + r + "deg)");
                            $("#eq1co0").css("-moz-transform", "rotate(" + r + "deg)");
                            $("#eq1co0").css("-webkit-transform", "rotate(" + r + "deg)");
                            $("#eq1co0").css("-o-transform", "rotate(" + r + "deg)");
                            r--;
                            if (r <= -35)
                                clearInterval(interval4);
                        }, 70);
                        bool21 = true;
                    }
                }
                if ((cont22 + rand22) < 645) {
                    animar("eq1co1", rand22);
                    cont22 = cont22 + rand22;
                    setTimeout(animar("lbl4", rand22), 700);
                    $("#lbl4").html(calcularProcentaje(cont22));
                }
                else {
                    if (bool22 == false) {
                        interval5 = setInterval(function () {
                            var css = '-webkit-transform: rotate(' + deg + 'deg);';
                            $("#eq1co1").css("transform", "rotate(" + r + "deg)");
                            $("#eq1co1").css("-moz-transform", "rotate(" + r + "deg)");
                            $("#eq1co1").css("-webkit-transform", "rotate(" + r + "deg)");
                            $("#eq1co1").css("-o-transform", "rotate(" + r + "deg)");
                            r--;
                            if (r <= -35)
                                clearInterval(interval5);
                        }, 70);
                        bool22 = true;
                    }
                }
                if ((cont23 + rand23) < 645) {
                    animar("eq1co2", rand23);
                    cont23 = cont23 + rand23;
                    setTimeout(animar("lbl5", rand23), 700);
                    $("#lbl5").html(calcularProcentaje(cont23));
                }
                else {
                    if (bool23 == false) {
                        interval6 = setInterval(function () {
                            var css = '-webkit-transform: rotate(' + deg + 'deg);';
                            $("#eq1co2").css("transform", "rotate(" + r + "deg)");
                            $("#eq1co2").css("-moz-transform", "rotate(" + r + "deg)");
                            $("#eq1co2").css("-webkit-transform", "rotate(" + r + "deg)");
                            $("#eq1co2").css("-o-transform", "rotate(" + r + "deg)");
                            r--;
                            if (r <= -35)
                                clearInterval(interval6);
                        }, 70);
                        bool23 = true;
                    }
                }
                //Esta parte de la funcion se dedica a comprobar quien ha ganado la carrera, contemplo la posibilidad de empate
                //EMPATE ----------------------------------
                if (bool21 == true && bool22 == true && bool23 == true && bool11 == true && bool12 == true && bool13 == true) {
                    // 5 segundos despues de finalizar la carrera le cambia las imagenes a los corredores ademas de ponerle el angulo de rotacion a 0
                    setTimeout(function () {

                        initRotate("eq1co0");
                        document.getElementById("eq1co0").setAttribute("src", "winner.png");
                        $("#lbl0").html("100%");

                        initRotate("eq1co1");
                        document.getElementById("eq1co1").setAttribute("src", "winner.png");
                        $("#lbl1").html("100%");

                        initRotate("eq1co2");
                        document.getElementById("eq1co2").setAttribute("src", "winner.png");
                        $("#lbl2").html("100%");

                        initRotate("eq0co0");
                        document.getElementById("eq0co0").setAttribute("src", "winner.png");
                        $("#lbl3").html("100%");

                        initRotate("eq0co1");
                        document.getElementById("eq0co1").setAttribute("src", "winner.png");
                        $("#lbl4").html("100%");

                        initRotate("eq0co2");
                        document.getElementById("eq0co2").setAttribute("src", "winner.png");
                        $("#lbl5").html("100%");

                        $("#estado1").attr("style", "visibility:visible");
                        $("#estado2").attr("style", "visibility:visible");
                        $("#estado1").attr("class", "lblestadoganador");
                        $("#estado2").attr("class", "lblestadoganador");
                        $("#estado1").html("Ganador");
                        $("#estado2").html("Ganador");
                        document.getElementById("buton").disabled = true;
                        document.getElementById("butonAgregar").disabled = false;
                        document.getElementById("btnPass").disabled = true;
                        document.getElementById("btnSave").disabled = true;
                        document.getElementById("btnLoad").disabled = false;
                    }, 5000);
                    clearInterval(timer);
                    bool21 = bool22 = bool23 = false;
                    cont11 = cont12 = cont13 = cont21 = cont22 = cont23 = 0;
                }
                //GANA EQUIPO2 ----------------------------------
                else if (bool21 == true && bool22 == true && bool23 == true) {
                    setTimeout(function () {

                        initRotate("eq1co0");
                        document.getElementById("eq1co0").setAttribute("src", "winner.png");
                        $("#lbl3").html("100%");

                        initRotate("eq1co1");
                        document.getElementById("eq1co1").setAttribute("src", "winner.png");
                        $("#lbl4").html("100%");

                        initRotate("eq1co2");
                        document.getElementById("eq1co2").setAttribute("src", "winner.png");
                        $("#lbl5").html("100%");

                        initRotate("eq0co0");
                        document.getElementById("eq0co0").setAttribute("src", "loser.png");

                        initRotate("eq0co1");
                        document.getElementById("eq0co1").setAttribute("src", "loser.png");

                        initRotate("eq0co2");
                        document.getElementById("eq0co2").setAttribute("src", "loser.png");

                        $("#estado1").attr("style", "visibility:visible");
                        $("#estado2").attr("style", "visibility:visible");
                        $("#estado1").attr("class", "lblestadoperdedor");
                        $("#estado2").attr("class", "lblestadoganador");
                        $("#estado1").html("Perdedor");
                        $("#estado2").html("Ganador");

                        document.getElementById("buton").disabled = true;
                        document.getElementById("butonAgregar").disabled = false;
                        document.getElementById("btnPass").disabled = true;
                        document.getElementById("btnSave").disabled = true;
                        document.getElementById("btnLoad").disabled = false;
                    }, 5000);
                    clearInterval(timer);
                    bool21 = bool22 = bool23 = false;
                    cont11 = cont12 = cont13 = cont21 = cont22 = cont23 = 0;
                }
                //GANA EQUIPO1 ----------------------------------
                else if (bool11 == true && bool12 == true && bool13 == true) {
                    setTimeout(function () {


                        initRotate("eq0co0");
                        document.getElementById("eq0co0").setAttribute("src", "winner.png");
                        $("#lbl0").html("100%");

                        initRotate("eq0co1");
                        document.getElementById("eq0co1").setAttribute("src", "winner.png");
                        $("#lbl1").html("100%");

                        initRotate("eq0co2");
                        document.getElementById("eq0co2").setAttribute("src", "winner.png");
                        $("#lbl2").html("100%");

                        initRotate("eq1co0");
                        document.getElementById("eq1co0").setAttribute("src", "loser.png");

                        initRotate("eq1co1");
                        document.getElementById("eq1co1").setAttribute("src", "loser.png");

                        initRotate("eq1co2");
                        document.getElementById("eq1co2").setAttribute("src", "loser.png");
                        $("#estado1").attr("style", "visibility:visible");
                        $("#estado2").attr("style", "visibility:visible");
                        $("#estado1").attr("class", "lblestadoganador");
                        $("#estado2").attr("class", "lblestadoperdedor");
                        $("#estado1").html("Ganador");
                        $("#estado2").html("Perdedor");

                        document.getElementById("buton").disabled = true;
                        document.getElementById("butonAgregar").disabled = false;
                        document.getElementById("btnPass").disabled = true;
                        document.getElementById("btnSave").disabled = true;
                        document.getElementById("btnLoad").disabled = false;

                    }, 5000);
                    clearInterval(timer);
                    bool11 = bool12 = bool13 = false;
                    cont11 = cont12 = cont13 = cont21 = cont22 = cont23 = 0;
                }
            });
        }
        	
    </script>
</head>
<body onload="prepararMapa()" style="background: url(web_background.jpg) no-repeat center top fixed; width: 100%;
   background-size: cover;">
            <div class="container">
	        <div class="row clearfix" style="margin-top:2%">
		        <div class="col-md-4 column"  > 
			        <h3 class="text-center" style="color:#a8bfe2;font-family:Verdana;font-size:30px;text-shadow: 1px 2px 3px #666">
				        Equipo 1
			        </h3>
			        <div class="row clearfix">
				        <div class="col-md-4 column">
                            <input class="classname" type="number" value="50" id="txt11"> </input> 
				        </div>
				        <div class="col-md-4 column">
                            <input class="classname" value="50" type="number" id="txt12"> </input>
				        </div>
				        <div class="col-md-4 column">
                            <input class="classname" value="50" type="number" id="txt13"> </input>
                            
				        </div>
			        </div>
                    <div class="row clearfix" style="text-align:center;font-size:20px;color:Black;font-family:Verdana;font-weight:bolder;margin-top:5px">
                            <label id="estado1">
                            </label>
                    </div>
		        </div>
                <div class="col-md-4 column" >
                    <div class="col-md-6 column" style="text-align:center">
                        <button type="button" class="classname" onclick="agregarPuntos()" id="butonAgregar">Empezar</button>
                        <button type="button" class="classname" onclick="pasarTurno()" id="buton">Mover</button>
                        <button id="btnPass" class="classname" type="button" onclick="pasarCarrera()">
                        Ver toda</button>
                        <div class="row clearfix">
		                <div class="col-md-12 column">
			                <a id="modal-420951" href="#modal-container-420951" role="button" class="btn" data-toggle="modal"><button id="Button1" class="classname" type="button"> Ayuda</button></a>
			                    <div class="modal fade" id="modal-container-420951" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				                    <div class="modal-dialog">
					                    <div class="modal-content">
						                    <div class="modal-header">
							                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
							                    <h4 class="modal-title" id="myModalLabel">
								                    Instrucciones
							                    </h4>
						                    </div>
						                    <div class="modal-body">
							                    <p>
                                                Bienvenidos a "La Volta App".
                                                <br />
                                                Esta aplicación emula una etapa de ciclismo entre dos equipos. Para empezar a jugar
                                                indique los puntos de energia para cada corredor.
                                                <br />
                                                Cada equipo dispone de 150 puntos de energia, indica los puntos para cada corredor
                                                y empezar a jugar!</p>
						                    </div>
						                    <div class="modal-footer">
							                    <button type="button" class="btn btn-default" data-dismiss="modal">Vale</button> 
						                    </div>
					                    </div>
				                    </div>
			                    </div>
		                </div>
	                </div>
                    </div>
                    <div class="col-md-6 column" >
                        <button type="button" class="classname" id="btnSave">Save Game</button>
                        <button type="button" class="classname" id="btnLoad">Load Game</button>
                        <input style="margin-top:3%" type="number" class="classname" id="key" value="0">
                    </div>
                </div>
		        <div class="col-md-4 column" >
			        <h3 class="text-center" style="color:#a8bfe2;font-family:Verdana;font-size:30px;text-shadow: 1px 2px 3px #666"> 
				        Equipo 2
			        </h3>
			        <div class="row clearfix">
				        <div class="col-md-4 column">
                            <input class="classname" value="50" type="number" id="txt21"> </input>
				        </div>
				        <div class="col-md-4 column">
                            <input class="classname" value="50" type="number" id="txt22"> </input>
				        </div>
				        <div class="col-md-4 column">
                            <input class="classname" value="50" type="number" id="txt23"> </input>
				        </div>
			        </div>
                    <div class="row clearfix" style="text-align:center;font-size:20px;color:Black;font-family:Verdana;font-weight:bolder;margin-top:5px">
                        <label id="estado2">
                        </label>
                    </div>
		        </div>
	        </div>
	        <div class="row clearfix">
		        
		        <div class="col-md-12 column">

		        </div>
	        </div>
	        

            <div class="col-md-12 column" >
                <div class="col-md-12 column" id="divgeneral" style="width:860px;margin-left:10%" >
                    <div class="col-md-12 column" id="divequipo1" style="margin-bottom:10px">
                        <div class="col-md-12 column c" id="c0" >
                           <label id="lbl0"></label>
		                </div>
                        <div class="col-md-12 column c"id="c1" >
                            <label id="lbl1"></label>
		                </div>
                        <div class="col-md-12 column c"id="c2">
                            <label id="lbl2"></label>
		                </div>
		            </div>
                    <div class="col-md-12 column" id="divequipo2" >
                        <div class="col-md-12 column c" id="c20" >
                            <label id="lbl3"></label>
		                </div>
                        <div class="col-md-12 column c" id="c21">
                            <label id="lbl4"></label>
		                </div>
                        <div class="col-md-12 column c" id="c22">
                            <label id="lbl5" ></label>
		                </div>
		            </div>
                </div>
            </div>
</body>
</html>
