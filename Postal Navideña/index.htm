<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>Postal Navidad</title>
    <style type="text/css">
        #myCanvas
        {
            background-image:url('background_green.jpg');
            background-repeat:no-repeat;
            width:626px;
            height:478px;
        }
    </style>
     <script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v4.7.4.min.js"></script>
</head>
<body>
    <div id="myCanvas">
    <embed src="sound.wav" autostart="true" hidden="true" loop="false">
    </div>

    <script defer="defer">

        //Layers disponibles -------------------------------------------------------------------------------------

        var layermoon = new Kinetic.Layer();
        var layerestrellas = new Kinetic.Layer();
        var layercopos = new Kinetic.Layer();
        var moon;

        //Stage --------------------------------------------------------------------------------------------------

        var stage = new Kinetic.Stage({
            container: 'myCanvas',
            width: 626,
            height: 468
        });

        //Copos --------------------------------------------------------------------------------------------------

        var copos = new Array();
        //Añadir copos al Array
        for (var i = 0, x1 = 10; i < 51; i++) {
            copos[i] = new Kinetic.Circle({
                x: x1,
                y: Math.random() * (-500) - 1,
                radius: 5,
                fill: 'white',
                stroke: 'black',
                strokeWidth: 0.1
            });
            //Añadir copos al layer
            layercopos.add(copos[i]);
            x1 = x1 + 17;
            };
        //Creación de la animacion copos
        var animacion_copos = new Kinetic.Animation(function (frame) {
            for (var i = 0; i < 51; i++) {
                if (copos[i].getAttr("y") < 477) 
                    copos[i].setY(copos[i].getY() + 1);
                else
                    copos[i].setY(Math.random() * (-500) - 1);
            }
        }, layercopos);
        //lanzamiento de la animacion copos
        animacion_copos.start();

        //Estrellas -----------------------------------------------------------------------------------------------

        var estrellas = new Array();
        //Creación de la imagen estrella
        var imageObjEstrellas = new Image();
        //Añadir las estrellas al array
        imageObjEstrellas.onload = function () {
            for (i = 0; i < 7; i++) {
                estrellas[i] = new Kinetic.Image({
                    image: imageObjEstrellas
                });
                //Añadir estrellas al layer
                layerestrellas.add(estrellas[i]);
            }
            //Le damos posición a cada ua de las estrellas
            estrellas[0].setX(50);
            estrellas[0].setY(70);

            estrellas[1].setX(120);
            estrellas[1].setY(27);


            estrellas[2].setX(230);
            estrellas[2].setY(60);

            estrellas[3].setX(330);
            estrellas[3].setY(40);
            
            estrellas[4].setX(380);
            estrellas[4].setY(100);

            estrellas[5].setX(470);
            estrellas[5].setY(30);

            estrellas[6].setX(580);
            estrellas[6].setY(86);

            //Animacion Estrella Fugaz --------------------------------------------
            //A cada estrella le damos 3 enventos, mousedown, mouseover, mouseout
            estrellas[0].on('mousedown', function () {
            //En el evento mousedown le asignamos una animacion: Cuando hacemos click en una estrella, 
            //esta sale dispara para arriba, cuando sale de pantalla vuelve a la posicion inicial y la animacion se para
                var animfugaz = new Kinetic.Animation(function (frame) {
                    if (estrellas[0].getAttr("y") >= -50) {
                        estrellas[0].setY(estrellas[0].getY() - Math.random() * (3) - 1);
                        estrellas[0].setX(estrellas[0].getX() - Math.random() * (3) - 1);
                    }
                    else {
                        estrellas[0].setX(50);
                        estrellas[0].setY(70);
                        animfugaz.stop();
                    }
                }, layerestrellas);

                animfugaz.start();
            });
            //En el evento mouseover, el cursor cambia de diseño
            estrellas[0].on('mouseover', function () {
                document.body.style.cursor = 'url(cris.cur), pointer';

            });
            //En el evento mouseout, el cursor recupera su diseño por defecto
            estrellas[0].on('mouseout', function () {
                document.body.style.cursor = 'default';
            });
            //----------------------------------------------------------------
            estrellas[1].on('mousedown', function () {
                var animfugaz = new Kinetic.Animation(function (frame) {
                    if (estrellas[1].getAttr("y") >= -50) {
                        estrellas[1].setY(estrellas[1].getY() - Math.random() * (3) - 1);
                        estrellas[1].setX(estrellas[1].getX() - Math.random() * (3) - 1);
                    }
                    else {
                        estrellas[1].setX(120);
                        estrellas[1].setY(27);
                        animfugaz.stop();
                    }
                }, layerestrellas);

                animfugaz.start();
            });

            estrellas[1].on('mouseover', function () {
                document.body.style.cursor = 'url(cris.cur), pointer';

            });
            estrellas[1].on('mouseout', function () {
                document.body.style.cursor = 'default';

            });
            //----------------------------------------------------------------
            estrellas[2].on('mousedown', function () {
                var animfugaz = new Kinetic.Animation(function (frame) {
                    if (estrellas[2].getAttr("y") >= -50) {
                        estrellas[2].setY(estrellas[2].getY() - Math.random() * (3) - 1);
                        estrellas[2].setX(estrellas[2].getX() - Math.random() * (3) - 1);
                    }
                    else {
                        estrellas[2].setX(230);
                        estrellas[2].setY(60);
                        animfugaz.stop();
                    }
                }, layerestrellas);

                animfugaz.start();
            });
            estrellas[2].on('mouseover', function () {
                document.body.style.cursor = 'url(cris.cur), pointer';
            });
            estrellas[2].on('mouseout', function () {
                document.body.style.cursor = 'default';
            });
            //----------------------------------------------------------------
            estrellas[3].on('mousedown', function () {
                var animfugaz = new Kinetic.Animation(function (frame) {
                    if (estrellas[3].getAttr("y") >= -50) {
                        estrellas[3].setY(estrellas[3].getY() - Math.random() * (3) - 1);
                        estrellas[3].setX(estrellas[3].getX() - Math.random() * (3) - 1);
                    }
                    else {
                        estrellas[3].setX(330);
                        estrellas[3].setY(40);
                        animfugaz.stop();
                    }
                }, layerestrellas);

                animfugaz.start();
            });
            estrellas[3].on('mouseover', function () {
                document.body.style.cursor = 'url(cris.cur), pointer';
            });
            estrellas[3].on('mouseout', function () {
                document.body.style.cursor = 'default';
            });
            //----------------------------------------------------------------
            estrellas[4].on('mousedown', function () {
                var animfugaz = new Kinetic.Animation(function (frame) {
                    if (estrellas[4].getAttr("y") >= -50) {
                        estrellas[4].setY(estrellas[4].getY() - Math.random() * (3) - 1);
                        estrellas[4].setX(estrellas[4].getX() - Math.random() * (3) - 1);
                    }
                    else {
                        estrellas[4].setX(380);
                        estrellas[4].setY(100);
                        animfugaz.stop();
                    }
                }, layerestrellas);

                animfugaz.start();
            });
            estrellas[4].on('mouseover', function () {
                document.body.style.cursor = 'url(cris.cur), pointer';
            });
            estrellas[4].on('mouseout', function () {
                document.body.style.cursor = 'default';
            });
            //----------------------------------------------------------------
            estrellas[5].on('mousedown', function () {
                var animfugaz = new Kinetic.Animation(function (frame) {
                    if (estrellas[5].getAttr("y") >= -50) {
                        estrellas[5].setY(estrellas[5].getY() - Math.random() * (3) - 1);
                        estrellas[5].setX(estrellas[5].getX() - Math.random() * (3) - 1);
                    }
                    else {
                        estrellas[5].setX(470);
                        estrellas[5].setY(30);
                        animfugaz.stop();
                    }
                }, layerestrellas);

                animfugaz.start();
            });
            estrellas[5].on('mouseover', function () {
                document.body.style.cursor = 'url(cris.cur), pointer';
            });
            estrellas[5].on('mouseout', function () {
                document.body.style.cursor = 'default';
            });
            //----------------------------------------------------------------
            estrellas[6].on('mousedown', function () {
                var animfugaz = new Kinetic.Animation(function (frame) {
                    if (estrellas[6].getAttr("y") >= -50) {
                        estrellas[6].setY(estrellas[6].getY() - Math.random() * (3) - 1);
                        estrellas[6].setX(estrellas[6].getX() - Math.random() * (3) - 1);
                    }
                    else {
                        estrellas[6].setX(580);
                        estrellas[6].setY(86);
                        animfugaz.stop();
                    }
                }, layerestrellas);
                animfugaz.start();
            });
            estrellas[6].on('mouseover', function () {
                document.body.style.cursor = 'url(cris.cur), pointer';
            });
            estrellas[6].on('mouseout', function () {
                document.body.style.cursor = 'default';
            });
        };
        //al objeto imagen de la estrella se le asigna una direccion
        imageObjEstrellas.src = "star.png";

        /*Animacion estrellas normal: Se le asigna una animación que hace que las estrellas,
        vayan disminuyendo y augmentando*/
        //La variable scale sera la encargada de ir aumentando o disminuyendo la escala
        var scale = 0.8;
        var aumenta = true;
        var anim2 = new Kinetic.Animation(function (frame) {
            for (i = 0; i < 7; i++) {
                if (aumenta == true) {
                    //si aumenta es = true, la variable scale augmente 0.001
                    scale = scale + 0.001;
                    /*si scale es >= 1 la variable aumenta se iguala a false
                    (Esto significa que la estrella pasara a disminuir)*/
                    if (scale >= 1)
                        aumenta = false;
                }
                //Si aumenta no es = true la estrella pasa a disminuir
                else {
                    scale = scale - 0.001;
                    if (scale <= 0.8)
                        aumenta = true;
                }
                //se cambia la escala de la estrella
                estrellas[i].setScale(scale);
            }

        }, layerestrellas);
        //Se lanza la animación
        anim2.start();

        // Luna --------------------------------------------------------------------------------------------------
        //animacion luna: Cogemos trozos de una imagen
        var animations = {
            llenar: [{
                x: 296,
                y: 0,
                width: 73,
                height: 66
            }, {
                x: 222,
                y: 0,
                width: 73,
                height: 66

            }, {
                x: 148,
                y: 0,
                width: 73,
                height: 66
            }, {
                x: 74,
                y: 0,
                width: 73,
                height: 66
            }, {
                x: 0,
                y: 0,
                width: 73,
                height: 66
            }]
        };
        //
        //Variables de Luna
        var moon;
        var pararMoon = false;
        var imageObjLuna = new Image();
        imageObjLuna.onload = function () {
            //Creamos un sprite 
            moon = new Kinetic.Sprite({
                x: 500,
                y: 15,
                image: imageObjLuna,
                animation: 'llenar',
                animations: animations,
                frameRate: 2
            });
            //Añadimos el sprite al layer
            layermoon.add(moon);
            //Le asignamos una animacion al sprite que incluye 3 eventos: mousedown, mouseover y mouseout
            var animluna = new Kinetic.Animation(function (frame) {
                //El evento mousedow hara que se inicie la animación del sprite
                moon.on('mousedown', function () {
                    if (pararMoon == false) {
                        moon.start();
                        pararMoon = true;
                    }
                    //Cuando se vuelva a producir el evento mousedown la animación parará
                    else {
                        moon.stop();
                        pararMoon = false;
                    }
                });
                //En el evento mouseover el cursor pasara a ser el de navidad
                moon.on('mouseover', function () {
                    document.body.style.cursor = 'url(cris.cur), pointer';
                });
                //En el evento mouseout el cursor pasara a ser el por defecto
                moon.on('mouseout', function () {
                    document.body.style.cursor = 'default';
                });
            }, layermoon);
            //Se lanza la animación
            animluna.start();
        };
        //Al objecto imagen de la luna se le asigna una dirección
        imageObjLuna.src = "moon.png";
        // Arbol -------------------------------------------------------------------------------------------------
        var encendido = false;
        var opacidad = 0.5;
        // Creamos una animación para los dos arboles, con todas las bombillas apagandose y encendiendo
        var animarbol = new Kinetic.Animation(function (frame) {
            if (encendido == false) {
                for (i = 0; i < 8; i++) {
                    bolasder[i].setOpacity(opacidad);
                    bolasizq[i].setOpacity(opacidad);
                }
                opacidad = opacidad + 0.005;
                if (opacidad >= 1) {
                    encendido = true;
                }
            }
            else {
                for (i = 0; i < 8; i++) {
                    bolasder[i].setOpacity(opacidad);
                    bolasizq[i].setOpacity(opacidad);
                }
                opacidad = opacidad - 0.005;
                if (opacidad <= 0.01) {
                    encendido = false;
                }
            }

        }, layermoon);

        animarbol.start();
        // Bolas Arbol -----------------------------------------------------------
        // creamos el array para los colores de las bolas
        var colores = new Array();
        colores[0] = "yellow";
        colores[1] = "purple";
        colores[2] = "blue";
        colores[3] = "blue";
        colores[4] = "red";
        colores[5] = "red";
        colores[6] = "yellow";
        colores[7] = "purple";
        //Creamos el array de pelotas (para el arbol de la derecha)
        var bolasder = new Array();
        for (var i = 0; i <= 7; i++) {
            // creamos 8 bolas
            bolasder[i] = new Kinetic.Circle({
                x: 20,
                y: 20,
                radius: 8,
                fill: colores[i],
                stroke: 'black',
                strokeWidth: 0.1,
                opacity:0.5
            });
            layermoon.add(bolasder[i]);
        }
        //Posicionamos las bolas en el arbol
        bolasder[0].setX(460);
        bolasder[0].setY(184);

        bolasder[1].setX(530);
        bolasder[1].setY(175);

        bolasder[2].setX(550);
        bolasder[2].setY(230);

        bolasder[3].setX(500);
        bolasder[3].setY(189);

        bolasder[4].setX(500);
        bolasder[4].setY(120);

        bolasder[5].setX(500);
        bolasder[5].setY(300);

        bolasder[6].setX(480);
        bolasder[6].setY(250);

        bolasder[7].setX(550);
        bolasder[7].setY(280);
        //------------------------------Bolas Izquierda
        // Hacemos lo mismo para el arbol de la izquierda
        var bolasizq = new Array();
        for (var i = 0; i <= 8; i++) {
            bolasizq[i] = new Kinetic.Circle({
                x: 20,
                y: 20,
                radius: 8,
                fill: colores[i],
                stroke: 'black',
                strokeWidth: 0.1,
                opacity: 0.5
            });
            layermoon.add(bolasizq[i]);
        }
        bolasizq[0].setX(120);
        bolasizq[0].setY(184);

        bolasizq[1].setX(180);
        bolasizq[1].setY(175);

        bolasizq[2].setX(150);
        bolasizq[2].setY(100);

        bolasizq[3].setX(130);
        bolasizq[3].setY(230);

        bolasizq[4].setX(150);
        bolasizq[4].setY(160);

        bolasizq[5].setX(130);
        bolasizq[5].setY(310);

        bolasizq[6].setX(160);
        bolasizq[6].setY(280);

        bolasizq[7].setX(100);
        bolasizq[7].setY(280);
        //Imagen de la familia con canticos

        var imageObjFamilia = new Image();
        imageObjFamilia.onload = function () {
            var family = new Kinetic.Image({
                image: imageObjFamilia
            });
            //Añadir faimilia al layer
            layermoon.add(family);
            family.setX(150);
            family.setY(250);

            family.on('mousedown', function () {
                //En el evento mousedown le asignamos una animacion: Cuando hacemos click en una estrella, 
                //esta sale dispara para arriba, cuando sale de pantalla vuelve a la posicion inicial y la animacion se para
            });
            //En el evento mouseover, el cursor cambia de diseño
            family.on('mouseover', function () {
                document.body.style.cursor = 'url(cris.cur), pointer';

            });
            //En el evento mouseout, el cursor recupera su diseño por defecto
            family.on('mouseout', function () {
                document.body.style.cursor = 'default';
            });
        }
        imageObjFamilia.src = "familia.png";
        // Se añaden los layers creados en todo el programa
        stage.add(layermoon);
        stage.add(layerestrellas);
        stage.add(layercopos);
    </script>

</body>
</html>
